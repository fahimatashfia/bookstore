<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>StoryStack Checkout</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* ----- PAGE HEADER ----- */
      .page-header {
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          var(--secondary-color) 100%
        );
        padding: 5rem 2.5rem 3rem;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .page-header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse"><path d="M 40 0 L 0 0 0 40" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)" /></svg>');
        opacity: 0.5;
      }

      .page-header h2 {
        font-family: "Playfair Display", serif;
        font-size: 3.5rem;
        font-weight: 900;
        color: white;
        margin-bottom: 1rem;
        position: relative;
        z-index: 1;
        animation: fadeInUp 0.8s ease-out;
      }

      /* ----- PROGRESS TRACKER ----- */
      .progress-tracker {
        max-width: 800px;
        margin: -2rem auto 3rem;
        padding: 0 2rem;
        position: relative;
        z-index: 10;
      }

      .progress-steps {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: white;
        padding: 2rem;
        border-radius: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        position: relative;
      }

      .progress-line {
        position: absolute;
        top: 50%;
        left: 10%;
        right: 10%;
        height: 4px;
        background: var(--bg-light);
        transform: translateY(-50%);
        z-index: 1;
      }

      .progress-line-fill {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--accent-color),
          var(--accent-light)
        );
        transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        border-radius: 2px;
      }

      .step {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        position: relative;
        z-index: 2;
      }

      .step-circle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: white;
        border: 4px solid var(--bg-light);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: #999;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
      }

      .step.active .step-circle {
        background: linear-gradient(
          135deg,
          var(--accent-color),
          var(--accent-light)
        );
        border-color: var(--accent-color);
        color: white;
        transform: scale(1.1);
        box-shadow: 0 4px 16px rgba(233, 69, 96, 0.4);
      }

      .step.completed .step-circle {
        background: linear-gradient(135deg, #27ae60, #2ecc71);
        border-color: #27ae60;
        color: white;
      }

      .step-label {
        font-size: 0.9rem;
        font-weight: 600;
        color: #999;
        transition: color 0.4s;
      }

      .step.active .step-label {
        color: var(--accent-color);
      }

      .step.completed .step-label {
        color: #27ae60;
      }

      /* ----- CHECKOUT CONTAINER ----- */
      .checkout-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 0 2.5rem 4rem;
      }

      .checkout-page {
        display: none;
        animation: fadeInUp 0.6s ease-out;
      }

      .checkout-page.active {
        display: block;
      }

      /* ----- CART SUMMARY ----- */
      .order-summary-card {
        background: white;
        padding: 2.5rem;
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .order-summary-card h2 {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: 2rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .order-summary-card h2 i {
        color: var(--accent-color);
      }

      .summary-items {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .summary-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.2rem;
        background: var(--bg-light);
        border-radius: 12px;
        transition: all 0.3s;
      }

      .summary-item:hover {
        background: rgba(233, 69, 96, 0.05);
        transform: translateX(5px);
      }

      .summary-item-info {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .summary-item-icon {
        width: 50px;
        height: 50px;
        background: linear-gradient(
          135deg,
          var(--accent-color),
          var(--accent-light)
        );
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.3rem;
      }

      .summary-item-details h4 {
        color: var(--text-dark);
        font-weight: 600;
        margin-bottom: 0.3rem;
      }

      .summary-item-details span {
        font-size: 0.9rem;
        color: #666;
      }

      .summary-item-price {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--accent-color);
      }

      .order-total {
        border-top: 2px solid rgba(0, 0, 0, 0.1);
        padding-top: 1.5rem;
        margin-top: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 1.8rem;
        font-weight: 700;
      }

      .order-total span:first-child {
        color: var(--text-dark);
      }

      .order-total span:last-child {
        color: var(--accent-color);
      }

      /* ----- FORM STYLING ----- */
      .checkout-form {
        background: white;
        padding: 2.5rem;
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .checkout-form h2 {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: 2rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .checkout-form h2 i {
        color: var(--accent-color);
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: var(--text-dark);
        font-size: 0.95rem;
      }

      .form-group label i {
        color: var(--accent-color);
        margin-right: 0.5rem;
      }

      .form-group input,
      .form-group textarea {
        width: 100%;
        padding: 1rem;
        border: 2px solid rgba(0, 0, 0, 0.1);
        border-radius: 12px;
        font-size: 1rem;
        font-family: "Poppins", sans-serif;
        transition: all 0.3s;
      }

      .form-group input:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(233, 69, 96, 0.1);
      }

      .form-group textarea {
        resize: vertical;
        min-height: 120px;
      }

      /* ----- RECEIPT ----- */
      .receipt-card {
        background: white;
        padding: 2.5rem;
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .receipt-header {
        text-align: center;
        padding-bottom: 2rem;
        border-bottom: 2px dashed rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
      }

      .receipt-header i {
        font-size: 4rem;
        color: var(--accent-color);
        margin-bottom: 1rem;
      }

      .receipt-header h2 {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-dark);
      }

      .receipt-info {
        background: var(--bg-light);
        padding: 1.5rem;
        border-radius: 12px;
        margin-bottom: 2rem;
      }

      .receipt-info-item {
        display: flex;
        padding: 0.8rem 0;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      }

      .receipt-info-item:last-child {
        border-bottom: none;
      }

      .receipt-info-item strong {
        min-width: 120px;
        color: var(--text-dark);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .receipt-info-item strong i {
        color: var(--accent-color);
      }

      .receipt-info-item span {
        color: #666;
      }

      /* ----- TERMS ----- */
      .terms-card {
        background: white;
        padding: 2.5rem;
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .terms-content {
        background: var(--bg-light);
        padding: 2rem;
        border-radius: 12px;
        max-height: 400px;
        overflow-y: auto;
        margin: 2rem 0;
      }

      .terms-content h3 {
        color: var(--text-dark);
        font-size: 1.3rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .terms-content h3 i {
        color: var(--accent-color);
      }

      .terms-content p {
        color: #555;
        line-height: 1.8;
        margin-bottom: 1rem;
        padding-left: 1.5rem;
      }

      /* ----- SUCCESS PAGE ----- */
      .success-card {
        background: white;
        padding: 3rem;
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .success-icon {
        width: 120px;
        height: 120px;
        background: linear-gradient(135deg, #27ae60, #2ecc71);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 2rem;
        font-size: 4rem;
        color: white;
        animation: scaleIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      }

      @keyframes scaleIn {
        0% {
          transform: scale(0) rotate(-180deg);
          opacity: 0;
        }
        100% {
          transform: scale(1) rotate(0deg);
          opacity: 1;
        }
      }

      .success-card h2 {
        font-size: 2.5rem;
        font-weight: 700;
        color: #27ae60;
        margin-bottom: 1rem;
      }

      .success-card p {
        font-size: 1.1rem;
        color: #555;
        line-height: 1.8;
        margin-bottom: 1rem;
      }

      .delivery-animation {
        position: relative;
        height: 100px;
        margin: 3rem 0;
        overflow: hidden;
      }

      .truck {
        position: absolute;
        width: 100px;
        height: 50px;
        background: var(--accent-color);
        border-radius: 10px;
        animation: drive 4s ease-in-out infinite;
      }

      .truck::before {
        content: "";
        position: absolute;
        width: 40px;
        height: 40px;
        background: var(--accent-light);
        border-radius: 5px;
        top: -35px;
        right: 10px;
      }

      .wheel {
        width: 18px;
        height: 18px;
        background: #333;
        border-radius: 50%;
        position: absolute;
        bottom: -9px;
        animation: rotate 1s linear infinite;
      }

      .wheel.left {
        left: 15px;
      }
      .wheel.right {
        right: 15px;
      }

      @keyframes drive {
        0%,
        100% {
          left: -120px;
        }
        50% {
          left: calc(100% - 20px);
        }
      }

      @keyframes rotate {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        background: var(--accent-color);
        animation: fall 3s linear infinite;
      }

      @keyframes fall {
        to {
          transform: translateY(500px) rotate(360deg);
          opacity: 0;
        }
      }

      /* ----- BUTTONS ----- */
      .btn-group {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
      }

      .btn {
        flex: 1;
        padding: 1rem 2rem;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        text-decoration: none;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--accent-color),
          var(--accent-light)
        );
        color: white;
        box-shadow: 0 6px 20px rgba(233, 69, 96, 0.3);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 28px rgba(233, 69, 96, 0.4);
      }

      .btn-secondary {
        background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        color: white;
        box-shadow: 0 6px 20px rgba(149, 165, 166, 0.3);
      }

      .btn-secondary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 28px rgba(149, 165, 166, 0.4);
      }

      .btn-success {
        background: linear-gradient(135deg, #27ae60, #2ecc71);
        color: white;
        box-shadow: 0 6px 20px rgba(39, 174, 96, 0.3);
      }

      .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 28px rgba(39, 174, 96, 0.4);
      }

      /* ----- ANIMATIONS ----- */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* ----- RESPONSIVE ----- */
      @media (max-width: 768px) {
        .page-header h2 {
          font-size: 2.5rem;
        }

        .progress-steps {
          padding: 1.5rem 1rem;
        }

        .step-circle {
          width: 50px;
          height: 50px;
          font-size: 1.2rem;
        }

        .step-label {
          font-size: 0.75rem;
        }

        .checkout-container {
          padding: 0 1.5rem 3rem;
        }

        .btn-group {
          flex-direction: column;
        }

        .order-summary-card,
        .checkout-form,
        .receipt-card,
        .terms-card,
        .success-card {
          padding: 1.5rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="navbar">
          <div class="logo">
            <i class="fas fa-book-open"></i>
            <h1>StoryStack</h1>
          </div>
          <nav class="nav-links">
            <a href="index.html" class="nav-link">
              <i class="fas fa-home"></i>
              <span>Home</span>
            </a>
            <a href="products.php" class="nav-link">
              <i class="fas fa-book"></i>
              <span>Browse Books</span>
            </a>
            <a href="cart.html" class="nav-link">
              <i class="fas fa-shopping-cart"></i>
              <span>Cart</span>
            </a>
          </nav>

          <div id="auth-links" class="auth-nav">
            <a href="about.html" class="nav-link">About Us</a>
            <span class="nav-divider">|</span>
            <a href="login.html" class="nav-link">Login</a>
            <span class="nav-divider">|</span>
            <a href="signup.html" class="btn-signup">Sign Up</a>
          </div>
        </div>
      </header>

      <main>
        <div class="page-header">
          <h2><i class="fas fa-credit-card"></i> Secure Checkout</h2>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
          <div class="progress-steps">
            <div class="progress-line">
              <div class="progress-line-fill" id="progressFill"></div>
            </div>
            <div class="step active" data-step="1">
              <div class="step-circle">
                <i class="fas fa-shopping-cart"></i>
              </div>
              <span class="step-label">Summary</span>
            </div>
            <div class="step" data-step="2">
              <div class="step-circle"><i class="fas fa-user"></i></div>
              <span class="step-label">Details</span>
            </div>
            <div class="step" data-step="3">
              <div class="step-circle"><i class="fas fa-file-invoice"></i></div>
              <span class="step-label">Review</span>
            </div>
            <div class="step" data-step="4">
              <div class="step-circle">
                <i class="fas fa-file-contract"></i>
              </div>
              <span class="step-label">Terms</span>
            </div>
            <div class="step" data-step="5">
              <div class="step-circle"><i class="fas fa-check"></i></div>
              <span class="step-label">Success</span>
            </div>
          </div>
        </div>

        <div class="checkout-container">
          <!-- Step 1: Cart Summary -->
          <div class="checkout-page active" id="cartPage">
            <div class="order-summary-card">
              <h2><i class="fas fa-receipt"></i> Order Summary</h2>
              <div class="summary-items" id="summaryItems"></div>
              <div class="order-total">
                <span>Total:</span>
                <span>$<span id="orderTotal">0.00</span></span>
              </div>
              <div class="btn-group">
                <button class="btn btn-secondary" onclick="goBack()">
                  <i class="fas fa-arrow-left"></i> Back to Store
                </button>
                <button class="btn btn-primary" onclick="goCheckout()">
                  Next <i class="fas fa-arrow-right"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Step 2: Checkout Form -->
          <div class="checkout-page" id="checkoutPage">
            <div class="checkout-form">
              <h2><i class="fas fa-user-circle"></i> Shipping Details</h2>
              <div class="form-group">
                <label><i class="fas fa-user"></i> Full Name</label>
                <input
                  type="text"
                  id="custName"
                  placeholder="Enter your full name"
                  required
                />
              </div>
              <div class="form-group">
                <label><i class="fas fa-envelope"></i> Email Address</label>
                <input
                  type="email"
                  id="custEmail"
                  placeholder="Enter your email"
                  required
                  readonly
                />
              </div>
              <div class="form-group">
                <label
                  ><i class="fas fa-map-marker-alt"></i> Shipping Address</label
                >
                <textarea
                  id="custAddress"
                  placeholder="Enter your complete shipping address"
                  rows="4"
                  required
                ></textarea>
              </div>
              <div class="btn-group">
                <button class="btn btn-secondary" onclick="backToCart()">
                  <i class="fas fa-arrow-left"></i> Back
                </button>
                <button class="btn btn-primary" onclick="showReceipt()">
                  Next <i class="fas fa-arrow-right"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Step 3: Receipt -->
          <div class="checkout-page" id="receiptPage">
            <div class="receipt-card">
              <div class="receipt-header">
                <i class="fas fa-file-invoice"></i>
                <h2>Order Receipt</h2>
              </div>
              <div class="receipt-info">
                <div class="receipt-info-item">
                  <strong><i class="fas fa-user"></i> Name:</strong>
                  <span id="rName"></span>
                </div>
                <div class="receipt-info-item">
                  <strong><i class="fas fa-envelope"></i> Email:</strong>
                  <span id="rEmail"></span>
                </div>
                <div class="receipt-info-item">
                  <strong
                    ><i class="fas fa-map-marker-alt"></i> Address:</strong
                  >
                  <span id="rAddress"></span>
                </div>
              </div>
              <h3 style="margin-bottom: 1rem; color: var(--text-dark)">
                <i class="fas fa-list" style="color: var(--accent-color)"></i>
                Order Items
              </h3>
              <div class="summary-items" id="receiptItems"></div>
              <div class="order-total">
                <span>Total:</span>
                <span>$<span id="rTotal"></span></span>
              </div>
              <div class="btn-group">
                <button class="btn btn-secondary" onclick="backToCheckout()">
                  <i class="fas fa-arrow-left"></i> Back
                </button>
                <button class="btn btn-primary" onclick="showTerms()">
                  Next <i class="fas fa-arrow-right"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Step 4: Terms & Conditions -->
          <div class="checkout-page" id="termsPage">
            <div class="terms-card">
              <h2
                style="
                  text-align: center;
                  color: var(--text-dark);
                  margin-bottom: 1rem;
                "
              >
                <i
                  class="fas fa-file-contract"
                  style="color: var(--accent-color)"
                ></i>
                Terms & Conditions
              </h2>
              <div class="terms-content">
                <h3><i class="fas fa-check-circle"></i> Order Terms</h3>
                <p>
                  1. All orders are subject to availability and confirmation of
                  the order price.
                </p>
                <p>
                  2. Payment must be completed within 24 hours to confirm your
                  order.
                </p>
                <p>
                  3. We reserve the right to refuse any order placed through our
                  website.
                </p>

                <h3><i class="fas fa-shipping-fast"></i> Delivery Policy</h3>
                <p>
                  4. Delivery times may vary depending on your location
                  (typically 3-7 business days).
                </p>
                <p>
                  5. Shipping costs are calculated at checkout based on your
                  location.
                </p>
                <p>
                  6. We are not responsible for delays caused by shipping
                  carriers.
                </p>

                <h3><i class="fas fa-dollar-sign"></i> Pricing & Taxes</h3>
                <p>
                  7. All prices are displayed in USD and include applicable
                  taxes.
                </p>
                <p>8. Prices are subject to change without notice.</p>

                <h3><i class="fas fa-undo"></i> Returns & Refunds</h3>
                <p>
                  9. Refunds can be requested within 7 days of delivery for
                  damaged items.
                </p>
                <p>
                  10. Return shipping costs are the responsibility of the
                  customer unless the item is defective.
                </p>
              </div>
              <div class="btn-group">
                <button
                  class="btn btn-secondary"
                  onclick="backToReceiptFromTerms()"
                >
                  <i class="fas fa-arrow-left"></i> Back
                </button>
                <button class="btn btn-success" id="acceptTermsBtn">
                  <i class="fas fa-check"></i> Accept & Place Order
                </button>
              </div>
            </div>
          </div>

          <!-- Step 5: Success -->
          <div class="checkout-page" id="successPage">
            <div class="success-card">
              <div class="success-icon">
                <i class="fas fa-check"></i>
              </div>
              <h2>Order Placed Successfully!</h2>
              <p>ðŸŽ‰ Thank you for shopping with StoryStack!</p>
              <p>A confirmation email has been sent to your email address.</p>
              <p>Your books will be shipped within 3-5 business days.</p>

              <div class="delivery-animation">
                <div class="truck">
                  <div class="wheel left"></div>
                  <div class="wheel right"></div>
                </div>
              </div>

              <button class="btn btn-primary" onclick="restart()">
                <i class="fas fa-home"></i> Back to Store
              </button>
            </div>
          </div>
        </div>
      </main>

      <footer>
        <p>&copy; 2025 StoryStack - Bookstore. All rights reserved.</p>
      </footer>
    </div>

    <script>
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      let user = JSON.parse(localStorage.getItem("user")) || null;
      let currentStep = 1;

      const pages = {
        1: document.getElementById("cartPage"),
        2: document.getElementById("checkoutPage"),
        3: document.getElementById("receiptPage"),
        4: document.getElementById("termsPage"),
        5: document.getElementById("successPage"),
      };

      function updateProgress() {
        const steps = document.querySelectorAll(".step");
        const progressFill = document.getElementById("progressFill");

        steps.forEach((step, index) => {
          const stepNum = index + 1;
          step.classList.remove("active", "completed");

          if (stepNum < currentStep) {
            step.classList.add("completed");
          } else if (stepNum === currentStep) {
            step.classList.add("active");
          }
        });

        const progress = ((currentStep - 1) / 4) * 100;
        progressFill.style.width = progress + "%";
      }

      function showPage(step) {
        Object.values(pages).forEach((page) => page.classList.remove("active"));
        pages[step].classList.add("active");
        currentStep = step;
        updateProgress();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function goBack() {
        window.location.href = "index.html";
      }

      function showCartSummary() {
        const summaryDiv = document.getElementById("summaryItems");
        let total = 0;

        if (cart.length === 0) {
          alert("Cart is empty");
          window.location.href = "cart.html";
          return;
        }

        summaryDiv.innerHTML = "";
        cart.forEach((item) => {
          const itemTotal = item.price * item.quantity;
          const div = document.createElement("div");
          div.className = "summary-item";
          div.innerHTML = `
      <div class="summary-item-info">
        <div class="summary-item-icon">
          <i class="fas fa-book"></i>
        </div>
        <div class="summary-item-details">
          <h4>${item.title}</h4>
          <span>Quantity: ${item.quantity} Ã— $${item.price.toFixed(2)}</span>
        </div>
      </div>
      <div class="summary-item-price">$${itemTotal.toFixed(2)}</div>
    `;
          summaryDiv.appendChild(div);
          total += itemTotal;
        });

        document.getElementById("orderTotal").innerText = total.toFixed(2);
      }

      function goCheckout() {
        if (!user) {
          alert("Please login first");
          window.location.href = "login.html";
          return;
        }
        showPage(2);
        custEmail.value = user.email;
        custName.value = user.name || "";
      }

      function backToCart() {
        showPage(1);
      }

      function showReceipt() {
        if (!custName.value || !custAddress.value) {
          alert("Please fill in all fields");
          return;
        }

        showPage(3);
        document.getElementById("rName").innerText = custName.value;
        document.getElementById("rEmail").innerText = custEmail.value;
        document.getElementById("rAddress").innerText = custAddress.value;

        const receiptItemsDiv = document.getElementById("receiptItems");
        receiptItemsDiv.innerHTML = "";
        let total = 0;

        cart.forEach((item) => {
          const itemTotal = item.price * item.quantity;
          const div = document.createElement("div");
          div.className = "summary-item";
          div.innerHTML = `
      <div class="summary-item-info">
        <div class="summary-item-icon">
          <i class="fas fa-book"></i>
        </div>
        <div class="summary-item-details">
          <h4>${item.title}</h4>
          <span>Quantity: ${item.quantity} Ã— $${item.price.toFixed(2)}</span>
        </div>
      </div>
      <div class="summary-item-price">$${itemTotal.toFixed(2)}</div>
    `;
          receiptItemsDiv.appendChild(div);
          total += itemTotal;
        });

        document.getElementById("rTotal").innerText = total.toFixed(2);
      }

      function backToCheckout() {
        showPage(2);
      }

      function showTerms() {
        showPage(4);
      }

      function backToReceiptFromTerms() {
        showPage(3);
      }

      function showSuccess() {
        showPage(5);
        localStorage.removeItem("cart");
        createConfetti();
      }

      function restart() {
        window.location.href = "index.html";
      }

      function createConfetti() {
        const successCard = document.querySelector(".success-card");
        const colors = ["#e94560", "#ff6b6b", "#1abc9c", "#3498db", "#f39c12"];

        for (let i = 0; i < 50; i++) {
          const confetti = document.createElement("div");
          confetti.className = "confetti";
          confetti.style.left = Math.random() * 100 + "%";
          confetti.style.background =
            colors[Math.floor(Math.random() * colors.length)];
          confetti.style.animationDelay = Math.random() * 3 + "s";
          confetti.style.animationDuration = Math.random() * 2 + 3 + "s";
          successCard.appendChild(confetti);
        }
      }

      function updateAuthLinks() {
        const user = JSON.parse(localStorage.getItem("user"));
        const authLinks = document.getElementById("auth-links");
        if (user) {
          authLinks.innerHTML = `
      <a href="about.html" class="nav-link">About Us</a>
      <span class="nav-divider">|</span>
      <span class="user-email"><i class="fas fa-user-circle"></i> ${user.username}</span>
      <span class="nav-divider">|</span>
      <a href="#" onclick="logout(); return false;" class="nav-link">Logout</a>
    `;
        } else {
          authLinks.innerHTML = `
      <a href="about.html" class="nav-link">About Us</a>
      <span class="nav-divider">|</span>
      <a href="login.html" class="nav-link">Login</a>
      <span class="nav-divider">|</span>
      <a href="signup.html" class="btn-signup">Sign Up</a>
    `;
        }
      }

      function logout() {
        localStorage.removeItem("user");
        window.location.href = "php/logout.php";
      }

      // Navbar scroll effect
      window.addEventListener("scroll", function () {
        const header = document.querySelector("header");
        if (window.scrollY > 50) {
          header.classList.add("scrolled");
        } else {
          header.classList.remove("scrolled");
        }
      });

      // Initialize
      showCartSummary();
      updateProgress();
      updateAuthLinks();

      document
        .getElementById("acceptTermsBtn")
        .addEventListener("click", showSuccess);
    </script>
  </body>
</html>